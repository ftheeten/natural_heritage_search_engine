<html>
<head>
	
	<link href="{{asset('assets/vendor/select2/dist/css/select2.min.css')}}" rel="stylesheet" />
	

</head>
<body>
<script src="{{asset('assets/vendor/jquery/dist/jquery.min.js')}}"></script>
<script src="{{asset('assets/vendor/select2/dist/js/select2.full.min.js')}}"></script>

<H1>Natural Heritage portal</H1>
{{form_start(form, {'action': path('naturalheritage_search_searchelasticsearch', {'textpattern':form.freetext.value|default('-1')}), 'attr':{'class': 'nh_submit'}})}}
Solr search<br/>

<select id="elastic_search_freetext" class="select2" style='width:300px'></select>
{{form_row(form.submit, {'label': 'search portal'})}}
{{form_end(form)}}
{% if facets is defined %}
<h3>Facets:</h3>
<ul>
    {% for facet in facets %}
	<li>{{facet['criteria']}}
	<ul>
		  {% for facet_detail in facet['details'] %}
		   <li>{{facet_detail['value']}}: {{facet_detail['count']}}</li>
		  {% endfor %}
	</ul></li>
    {% endfor %}
</ul>
{% endif %}
{% if results is defined %}
<h3>Results:</h3>
<ul>
    {% for result in results %}
	<li><ul>
	<li>{{ result.institution }}</li>
	<li>{{ result.bundleName }}</li>
	<li>{{ result.title }}</li>
        <li><a href={{ result.id }} target="_blank">{{ result.id }}</a></li>
	</ul></li>
    {% endfor %}
</ul>
{% endif %}
</div>
<script type="text/javascript">
	$(document).ready(

		function()
		{	

			
			$(".nh_submit").submit(
			
				function()
				{
					$(".nh_submit").attr('action', $(".nh_submit").attr('action').replace(/\/-1/,'/'.concat($("#elastic_search_freetext").val())) );//{{ app.request.uri }}.concat($("#solr_search_freetext").val())).submit();
				}
			);

			$('.select2').select2({
				//width: "300px",
				tags: true,
				multiple: false,
				  ajax: {
				    url: "{{ url('homepage') }}autocompleteselect2",
				    data: function (params) {
				      var query = {
					q: params.term
				      }

				      // Query parameters will be ?search=[term]&type=public
					
				      return query;
				    },
					processResults: function(data) {
					       return {results: data};
					}
				  }
				});
		}
	);
</script>
</body>
</html>
